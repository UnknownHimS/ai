<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bible API Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    select, button { margin: 0.5rem 0; padding: 0.5rem; font-size: 1rem; }
    #verses { margin-top: 1rem; }
    .verse { margin-bottom: 0.8rem; }
    .verse-number { font-weight: bold; margin-right: 0.5rem; }
  </style>
</head>
<body>
  <h1>Bible API Demo</h1>

  <label for="translation">Choose Translation:</label><br/>
  <select id="translation"></select><br/>

  <label for="book">Choose Book:</label><br/>
  <select id="book"></select><br/>

  <label for="chapter">Choose Chapter:</label><br/>
  <select id="chapter"></select><br/>

  <button id="load">Load Verses</button>

  <div id="verses"></div>

  <script>
    const apiBase = 'https://bible.helloao.org/api';

    const translationSelect = document.getElementById('translation');
    const bookSelect = document.getElementById('book');
    const chapterSelect = document.getElementById('chapter');
    const loadBtn = document.getElementById('load');
    const versesDiv = document.getElementById('verses');

    // Fetch available translations and populate dropdown
    async function loadTranslations() {
      try {
        const res = await fetch(`${apiBase}/available_translations.json`);
        const data = await res.json();
        // data is an object with keys as translation codes and values as info
        for (const [key, value] of Object.entries(data)) {
          const option = document.createElement('option');
          option.value = key;
          option.textContent = `${value.name} (${key.toUpperCase()})`;
          translationSelect.appendChild(option);
        }
      } catch (err) {
        alert('Failed to load translations: ' + err.message);
      }
    }

    // Fetch books for selected translation
    async function loadBooks(translation) {
      bookSelect.innerHTML = '';
      chapterSelect.innerHTML = '';
      versesDiv.innerHTML = '';
      try {
        const res = await fetch(`${apiBase}/${translation}/books.json`);
        const data = await res.json();
        // data is an array of book objects [{name, short_name, chapters}]
        data.forEach(book => {
          const option = document.createElement('option');
          option.value = book.short_name;
          option.textContent = book.name;
          bookSelect.appendChild(option);
        });
        // Auto load chapters for first book
        if (data.length > 0) {
          loadChapters(translation, data[0].short_name);
        }
      } catch (err) {
        alert('Failed to load books: ' + err.message);
      }
    }

    // Load chapters for selected book
    async function loadChapters(translation, book) {
      chapterSelect.innerHTML = '';
      versesDiv.innerHTML = '';
      try {
        const res = await fetch(`${apiBase}/${translation}/${book}/1.json`);
        if (!res.ok) throw new Error('Chapter not found');
        const data = await res.json();
        // data.verses is an array, so length = chapter length, but API might not give chapter count
        // So we can guess chapter count by trying next chapters until fail OR
        // The books.json has chapters count per book, let's use that:
        const booksRes = await fetch(`${apiBase}/${translation}/books.json`);
        const books = await booksRes.json();
        const bookData = books.find(b => b.short_name === book);
        if (!bookData) throw new Error('Book data missing');

        for (let i = 1; i <= bookData.chapters; i++) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = i;
          chapterSelect.appendChild(option);
        }
      } catch (err) {
        alert('Failed to load chapters: ' + err.message);
      }
    }

    // Load verses for selected translation, book, chapter
    async function loadVerses(translation, book, chapter) {
      versesDiv.innerHTML = 'Loading...';
      try {
        const res = await fetch(`${apiBase}/${translation}/${book}/${chapter}.json`);
        if (!res.ok) throw new Error('Chapter not found');
        const data = await res.json();
        versesDiv.innerHTML = '';
        data.verses.forEach(v => {
          const verseEl = document.createElement('div');
          verseEl.className = 'verse';
          verseEl.innerHTML = `<span class="verse-number">${v.verse}.</span> ${v.text}`;
          versesDiv.appendChild(verseEl);
        });
      } catch (err) {
        versesDiv.innerHTML = 'Failed to load verses: ' + err.message;
      }
    }

    // Event Listeners
    translationSelect.addEventListener('change', e => {
      loadBooks(e.target.value);
    });

    bookSelect.addEventListener('change', e => {
      loadChapters(translationSelect.value, e.target.value);
    });

    loadBtn.addEventListener('click', () => {
      loadVerses(translationSelect.value, bookSelect.value, chapterSelect.value);
    });

    // Initial load
    loadTranslations().then(() => {
      if (translationSelect.value) {
        loadBooks(translationSelect.value);
      }
    });
  </script>
</body>
</html>
