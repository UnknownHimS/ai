<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sci-Fi AI Chatbot</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
 <script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('userInput');

  // Detect intent from input text
  function detectIntent(input) {
    const lower = input.toLowerCase();
    if (lower.includes("born")) return "born";
    if (lower.includes("died")) return "died";
    if (lower.includes("when")) return "when";
    if (lower.includes("who")) return "who";
    if (lower.includes("where")) return "where";
    if (lower.includes("how")) return "how";
    if (lower.includes("why")) return "why";
    if (lower.includes("what")) return "what";
    return "what"; // default fallback
  }

  // Extract topic by filtering out common filler words
  function extractTopic(input) {
    const lower = input.toLowerCase().replace(/[?.,!]/g, '');
    const stopwords = ['what', 'who', 'when', 'where', 'how', 'why', 'born', 'died', 'is', 'are', 'was', 'were', 'the', 'a', 'an', 'of', 'on', 'in', 'to', 'by', 'for', 'about', 'do', 'does', 'did', 'explain', 'define', 'tell', 'me', 'it', 'that', 'you'];
    const words = lower.split(' ').filter(word => !stopwords.includes(word));
    return words.slice(0, 4).join(' ');
  }

  // Fetch Wikipedia summary for topic
  async function fetchWikiSummary(topic) {
    if (!topic) return null;

    const formattedTopic = topic
      .split(' ')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');

    const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(formattedTopic)}`;

    try {
      const res = await fetch(url);
      if (!res.ok) return null;

      const data = await res.json();
      return data.extract || null;
    } catch {
      return null;
    }
  }

  // Extract birth and death dates from summary text
  function extractBirthDeath(summary) {
    // Pattern: (14 March 1879 â€“ 18 April 1955)
    const dateRangePattern = /\(([^()]+?)\s*[â€“-]\s*([^()]+?)\)/;
    // Pattern: (born 14 March 1879)
    const singleDatePattern = /\((born\s+)?([^()]+?)\)/i;

    let match = summary.match(dateRangePattern);
    if (match) {
      return {
        birthDate: match[1].trim(),
        deathDate: match[2].trim()
      };
    }

    match = summary.match(singleDatePattern);
    if (match) {
      return {
        birthDate: match[2].trim(),
        deathDate: null
      };
    }

    return null;
  }

  // Append message to chat box
  function appendMessage(sender, text) {
    const p = document.createElement('p');
    p.className = sender;
    p.textContent = (sender === 'user' ? 'ğŸ§‘ You: ' : 'ğŸ¤– ShabbyBot: ') + text;
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
  }

  // Main function to get chatbot response
  async function getResponse(inputText) {
    const intent = detectIntent(inputText);
    const topic = extractTopic(inputText);

    const summary = await fetchWikiSummary(topic);

    if (!summary) return `I couldn't find anything about "${topic}".`;

    const lowerInput = inputText.toLowerCase();

    const dates = extractBirthDeath(summary);

    if ((intent === 'born' || (intent === 'when' && lowerInput.includes('born'))) && dates?.birthDate) {
      return `${topic.charAt(0).toUpperCase() + topic.slice(1)} was born on ${dates.birthDate}.`;
    }

    if ((intent === 'died' || (intent === 'when' && lowerInput.includes('died'))) && dates?.deathDate) {
      return `${topic.charAt(0).toUpperCase() + topic.slice(1)} died on ${dates.deathDate}.`;
    }

    // Default: return full summary
    return summary;
  }

  // Send message handler
  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    appendMessage('user', text);
    input.value = '';
    const botReply = await getResponse(text);
    appendMessage('bot', botReply);
  }

  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage();
  });
</script>

</head>
<body>
  <h1>Please use proper spelling; this chatbot is still learning.</h1>

  <div id="chat"></div>
  <div id="inputArea">
    <input type="text" id="userInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
  </div>

<script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('userInput');

  function appendMessage(sender, text) {
    const p = document.createElement('p');
    p.className = sender;
    p.textContent = (sender === 'user' ? 'ğŸ§‘ You: ' : 'ğŸ¤– ShabbyBot: ') + text;
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
  }

  // Detect intent from user input
  function detectIntent(text) {
    const lower = text.toLowerCase();
    if (lower.includes('born')) return 'born';
    if (lower.includes('died')) return 'died';
    if (lower.includes('when')) return 'when';
    if (lower.includes('who')) return 'who';
    if (lower.includes('where')) return 'where';
    if (lower.includes('how')) return 'how';
    if (lower.includes('why')) return 'why';
    if (lower.includes('what')) return 'what';
    return 'what';
  }

  // Extract topic by removing question words and filler words
  function extractTopic(input) {
    const stopwords = [
      'what','who','when','where','how','why',
      'born','died','is','are','was','were',
      'the','a','an','of','on','in','to','by','for','about',
      'do','does','did','explain','define','tell','me','it','that','you',
      'please','can','could','would','show','give','find'
    ];
    const words = input.toLowerCase()
      .replace(/[?.,!]/g, '')
      .split(' ')
      .filter(w => !stopwords.includes(w));
    return words.join(' ').trim();
  }

  // Extract birth/death dates from Wikipedia summary text
  function extractBirthDeath(summary) {
    const match = summary.match(/\(([^)]+)\)/);
    if (!match) return null;
    const dates = match[1].split('â€“').map(s => s.trim());
    return {
      birthDate: dates[0] || null,
      deathDate: dates[1] || null
    };
  }

  // Fetch Wikipedia summary for topic
  async function fetchWikiSummary(topic) {
    if (!topic) return "I couldn't figure out what to search for.";

    // Capitalize first letter of each word (Wikipedia expects that)
    const capitalizedTopic = topic
      .split(' ')
      .map(w => w.charAt(0).toUpperCase() + w.slice(1))
      .join(' ');

    const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(capitalizedTopic)}`;

    try {
      const res = await fetch(url);
      if (!res.ok) return `I couldn't find anything about "${capitalizedTopic}".`;

      const data = await res.json();

      if (data.extract) {
        return data.extract;
      } else {
        return `I found a page but no summary for "${capitalizedTopic}".`;
      }
    } catch (e) {
      console.error(e);
      return "There was a problem fetching info from Wikipedia.";
    }
  }

  // Main chatbot response function
  async function getResponse(inputText) {
    const intent = detectIntent(inputText);
    const topic = extractTopic(inputText);

    const summary = await fetchWikiSummary(topic);

    // If the intent is born or when + born, try to extract birth date
    if (intent === 'born' || (intent === 'when' && inputText.toLowerCase().includes('born'))) {
      const dates = extractBirthDeath(summary);
      if (dates && dates.birthDate) {
        return `${topic.charAt(0).toUpperCase() + topic.slice(1)} was born on ${dates.birthDate}.`;
      }
    }

    // If the intent is died or when + died, try to extract death date
    if (intent === 'died' || (intent === 'when' && inputText.toLowerCase().includes('died'))) {
      const dates = extractBirthDeath(summary);
      if (dates && dates.deathDate) {
        return `${topic.charAt(0).toUpperCase() + topic.slice(1)} died on ${dates.deathDate}.`;
      }
    }

    // Default: return the summary (or fallback)
    return summary;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    appendMessage('user', text);
    input.value = '';

    const reply = await getResponse(text);
    appendMessage('bot', reply);
  }

  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage();
  });
</script>
</body>
</html>
